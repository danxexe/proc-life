<!DOCTYPE html>

<html>
<head>
    <title>Page Title</title>
    <script type="text/javascript" src="riffwave.js"></script><!-- THNX pedro.ladaria for the sweet <audio> encoder!!! --->
</head>

<body>


<script type="text/javascript">

    var ctx, mx, my, dx, dy,
    b, bb, bbb, bx, bbx, bbbx, bg, pxl1, pxl2,
    WIDTH = window.innerWidth,
    HEIGHT = window.innerHeight;
    
    document.write("<canvas id='canvas' style='display:block;position:absolute;top:0px;left:0px;' width="+WIDTH+" height="+HEIGHT+"></canvas>");
    
    setup();
    setInterval(draw, 1000 / 60);
    
	function setup() {
		var canvas;		    
		canvas = document.getElementById("canvas");
		ctx = canvas.getContext("2d");
                document.addEventListener('keydown',doKeyDown,false);
		bg = "#000";
		ctx.fillStyle = bg;
		ctx.fillRect(0,0,WIDTH,HEIGHT);	
		mxPos = WIDTH-32; myPos = (HEIGHT/2)-4;
		mx = mxPos-(mxPos%8); my = myPos-(myPos%8);	
		dx = 8; dy = 8;
		b = 0; bb = 96; bbb = 64;
		bbbx = bbx = bx = 8; 
		pxl1 = '#'+Math.floor(Math.random()*16777215).toString(16);
		pxl2 = '#'+Math.floor(Math.random()*16777215).toString(16);
		pxl3 = '#'+Math.floor(Math.random()*16777215).toString(16);
		bass = 10;
	}
        
         window.onresize = function(){
            WIDTH = window.innerWidth ;
            HEIGHT = window.innerHeight ;				
            canvas.width = WIDTH;
            canvas.height = HEIGHT;
	    ctx.fillStyle = bg;
	    ctx.fillRect(0,0,WIDTH,HEIGHT);
	    if (HEIGHT < b) {b = 0;}
	    if (HEIGHT < bb) {bb = 0;}
	    if (HEIGHT < bbb) {bbb = 0;}
        }
	
	function clr() {
	    var data = []; 
	    for (var i=0; i<100; i++) data[i] = Math.round(255 * Math.random()); 
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 
	    bg = '#'+Math.floor(Math.random()*16777215).toString(16);
	    ctx.fillStyle = bg;
	    ctx.fillRect(0,0,WIDTH,HEIGHT);
		pxl1 = '#'+Math.floor(Math.random()*16777215).toString(16);
		pxl2 = '#'+Math.floor(Math.random()*16777215).toString(16);
		pxl3 = '#'+Math.floor(Math.random()*16777215).toString(16);
	    if (bass == 10) {bass = 8;} else {bass = 10;}
	}	
	function click() {
	    var data = []; 
	    for (var i=0; i<200; i++) data[i] = Math.round(Math.exp(i/3));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 	    
	}
	function click2() {
	    var data = []; 
	    for (var i=0; i<200; i++) data[i] = Math.round(Math.exp(3/i));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 	    
	}
	function click3() {
	    var data = []; 
	    for (var i=0; i<1000; i++) data[i] = 128+Math.round(127*Math.sin(i/bass));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 	    
	}
	
	
	function soundRight() {
	    var data = []; 
	    for (var i=0; i<1000; i++) data[i] = 128+Math.round(127*Math.sin(i/5));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 
	}
	function soundDown() {
	    var data = []; 
	    for (var i=0; i<1000; i++) data[i] = 128+Math.round(127*Math.sin(i/4));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 
	}
	function soundLeft() {
	    var data = []; 
	    for (var i=0; i<1000; i++) data[i] = 128+Math.round(127*Math.sin(i/3));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 
	}
	function soundUp() {
	    var data = []; 
	    for (var i=0; i<1000; i++) data[i] = 128+Math.round(127*Math.sin(i/3.8));
	    var wave = new RIFFWAVE(data); 
	    var audio = new Audio(wave.dataURI); 
	    audio.play(); 
	}
	
        function doKeyDown(evt){
            switch (evt.keyCode) {
              case 38: if (my > 0){ my -= dy;} soundUp(); break; //up arrow
              case 40: if (my + dy < HEIGHT-8){ my += dy;} soundDown(); break; //down arrow
              case 39: if (mx + dx < WIDTH-8){ mx += dx;} soundRight(); break; //right arrow
              case 37: if (mx > 0){ mx -= dx;} soundLeft(); break; //left arrow
	      case 66: clr(); break;
	      case 189: if (bx != 0 && b > 8 && b < HEIGHT-8) {time1 = bx; bx = 0}; break; //pause pxl1
	      case 187: if (bx == 0) {bx = time1}; break;
	      case 219: if (bbx != 0 && bb > 8 && bb < HEIGHT-8) {time2 = bbx; bbx = 0}; break; //pause pxl2
	      case 221: if (bbx == 0) {bbx = time2}; break;
	      case 186: if (bbbx != 0 && bbb > 8 && bbb < HEIGHT-8) {time3 = bbbx; bbbx = 0}; break; //pause pxl3
	      case 222: if (bbbx == 0) {bbbx = time3}; break;
            }
          }
	  
	  
	function pxl(x,y, col) {
	    ctx.beginPath();
	    ctx.fillStyle = col;
	    ctx.moveTo(x,y);
	    ctx.lineTo(x+8,y);
	    ctx.lineTo(x+8,y+8);
	    ctx.lineTo(x,y+8);
	    ctx.closePath();
	    ctx.fill();
	}
	
	if (window.DeviceOrientationEvent) {
	  console.log("DeviceOrientation is supported");
	  window.addEventListener('deviceorientation', function(eventData) {
		var LR = eventData.gamma;
		var FB = eventData.beta;
		var DIR = eventData.alpha;
		orient = [LR,FB,DIR];
	    }, false);
	}
	
	
	function draw() {
	    ctx.fillStyle = bg;
	    ctx.fillRect(0,0,72,HEIGHT);
	    
	    col = '#'+Math.floor(Math.random()*16777215).toString(16);		
	    pxl(mx,my,col);
	    
	    b += bx; bb += bbx; bbb += bbbx;
	    pxl(0,b,pxl1);
	    pxl(32,bb,pxl2);
	    pxl(64,bbb,pxl3);
	    if (b > HEIGHT-8 || b < 0) { bx = -bx; click()}
	    if (bb > HEIGHT-8 || bb < 0) { bbx = -bbx; click2()}
	    if (bbb > HEIGHT-8 || bbb < 0) { bbbx = -bbbx; click3()}
	       
	}
	
	

	
	


</script>


</body>
</html>
